(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const g=[{urn:"URN:NBN:no-nb_digibok_2009021704085",title:"NTR - Det nye testamente revidert . [ 1 ] : Lukasevangeliet , Første tessalonikerbrev , Andre tessalonikerbrev , Galaterbrevet , Filipperbrevet",year:2003,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100010961.0"},{urn:"URN:NBN:no-nb_digibok_2008052304066",title:"Det Nye testamente : oversatt for ungdom",year:1959,authors:"Osnes , Torbjørn",publisher:"Det Norske bibelselskaps forl.",langs:"nob",dhlabid:"100040613.0"},{urn:"URN:NBN:no-nb_digibok_2011060308011",title:"Det nye testamentet",year:2005,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100048618.0"},{urn:"URN:NBN:no-nb_digibok_2012033008102",title:"Evangeliet etter Lukas",year:1973,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100084964.0"},{urn:"URN:NBN:no-nb_digibok_2012081508153",title:"Vær ikke redde : evangeliet etter Markus",year:1951,authors:"Skard , Vemund / Osnes , Torbjørn",publisher:"Det norske bibelselskaps forlag",langs:"nob / grc",dhlabid:"100100888.0"},{urn:"URN:NBN:no-nb_digibok_2013030506026",title:"Bibelen : det Gamle og det Nye testamente : [ bokmål ]",year:1978,publisher:"Det Norske bibelselskaps forlag",langs:"nob",dhlabid:"100138726.0"},{urn:"URN:NBN:no-nb_digibok_2013020808015",title:"NTR - Det nye testamente revidert . [ 2 ] : Markusevangeliet , Romerbrevet , Første korinterbrev , Andre korinterbrev",year:2003,publisher:"Det norske bibelselskap",langs:"mul / nob / nno",dhlabid:"100139398.0"},{urn:"URN:NBN:no-nb_digibok_2013061206082",title:"NTR - Det nye testamente revidert . [ 3 ] : Matteusevangeliet , Efeserbrevet , Kolosserbrevet",year:2004,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100152845.0"},{urn:"URN:NBN:no-nb_digibok_2015110407068",title:"Godt nytt : Det nye testamentet for menneske i dag ; illustrert av Annie Vallotton",year:1976,authors:"Vallotton , Annie",publisher:"Bibelselskapet",langs:"nno",dhlabid:"100274283.0"},{urn:"URN:NBN:no-nb_digibok_2016061748023",title:"Godt nytt : Det nye testamente for mennesker i dag : ny oversettelse av 1975",year:1975,authors:"Vallotton , Annie",publisher:"Det norske bibelselskaps forl.",langs:"nob / gre",dhlabid:"100297911.0"},{urn:"URN:NBN:no-nb_digibok_2018020748002",title:"Når Ordet blir norsk : norske bibeloversettelser 1945-2011",year:2011,authors:"Bøe , Sverre / Holmås , Geir Otto",publisher:"Tapir akademisk forl.",langs:"nob",dhlabid:"100364017.0"},{urn:"URN:NBN:no-nb_digibok_2018030805008",title:"Utvalg av det Gamle testamente : oversettelse av 1966",year:1966,publisher:"Det Norske bibelselskaps forl.",langs:"nob / heb",dhlabid:"100365478.0"},{urn:"URN:NBN:no-nb_digibok_2017091807031",title:"Bibelen , eller Den Hellige skrift : det gamle og det Nye testamentes kanoniske bøker",year:1930,publisher:"Det Norske bibelselskap",langs:"nob",dhlabid:"100482251.0"},{urn:"URN:NBN:no-nb_digibok_2019061928001",title:"Biblia : Det er den gantske Hellige Scrifft , vdsæt paa Danske",year:1550,publisher:"aff Ludowich Dietz",langs:"dan",dhlabid:"100484406.0"},{urn:"URN:NBN:no-nb_digibok_2021012648506",title:"Bibelen , eller Den hellige Skrift indeholdende det Gamle og Nye Testamentes kanoniske Bøger",year:1905,publisher:"Det norske Bibelselskabs Forl.",langs:"nob",dhlabid:"100485380.0"},{urn:"URN:NBN:no-nb_digibok_2016031029001",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 3 : Den Tredie Part Af det Gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan",dhlabid:"100492545.0"},{urn:"URN:NBN:no-nb_digibok_2016040729001",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 1 : Den første Part Af det Gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan",dhlabid:"100492584.0"},{urn:"URN:NBN:no-nb_digibok_2016040729002",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 2 : Den Anden Part Af det gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan",dhlabid:"100492585.0"},{urn:"URN:NBN:no-nb_digibok_2010110206027",title:"Evangilja : eller Fagnad-bodi etter Mattæus",year:1915,authors:"Seippel , Alexander",publisher:"Det norske bibel-sellskape",langs:"nno / grc",dhlabid:"100520866.0"},{urn:"URN:NBN:no-nb_digibok_2011052608017",title:"Det nye testamentet",year:2005,publisher:"Det norske bibelselskap",langs:"nno",dhlabid:"100540180.0"},{urn:"URN:NBN:no-nb_digibok_2011053008068",title:"NTR - Det nye testamente revidert . [ 5 ] : Apostlenes gjerninger , Første timoteusbrev , Andre timoteusbrev , Brevet til Titus , Brevet til Filemon , Hebreerbrevet , Jakobs brev , Første petersbrev , Andre petersbrev , Judas ' brev",year:2005,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100552275.0"},{urn:"URN:NBN:no-nb_digibok_2022030107531",title:"Bibelen : Den hellige skrift : Det gamle og Det nye testamente",year:1985,publisher:"Det norske bibelselskap",langs:"nob",dhlabid:"100582412.0"},{urn:"URN:NBN:no-nb_digibok_2021041548624",title:"Bibelen , eller den Hellige Skrift : indeholdende Det gamle og nye Testaments kanoniske Bøger , tilligemed Det gamle Testamentes apokryfiske Bøger",year:1908,langs:"nob",dhlabid:"100588397.0"},{urn:"URN:NBN:no-nb_digibok_2022011028001",title:"Biblia : Det er , Den gantske Hellige Scrifft , paa Danske",year:1589,authors:"Dietrich , Veit / Luther , Martin",publisher:"Aff Matz Vingaardt",langs:"dan",dhlabid:"100596484.0"},{urn:"URN:NBN:no-nb_digibok_2022011928001",title:"Biblia : Det er Den gantske Hellige Scrifft paa Danske",year:1633,authors:"Luther , Martin / Dietrich , Veit / Martzan , Melchior / Sartor , Salomon",publisher:"Prentet ved Melchior Martzan",langs:"dan",dhlabid:"100606092.0"},{urn:"URN:NBN:no-nb_digibok_2022030107535",title:"Bibelen : det Gamle og det Nye testamentet : [ nynorsk ]",year:1978,publisher:"Det Norske bibelselskap",langs:"nno",dhlabid:"100609051.0"},{urn:"URN:NBN:no-nb_digibok_2022012528002",title:"Biblia , Paa Danske : Det er Den gantske hellige scriftis Bøgger igen [ n ] em seete med flijd effter den Ebræiske oc Grækeske Text etc. det negste mueligt vaar Oc effter som de paa andre atskillige Tungemaal vaare best vdsatte",year:1607,authors:"Resen , Hans Poulsen",publisher:"[utgiver ikke identifisert]",langs:"dan",dhlabid:"100612630.0"},{urn:"URN:NBN:no-nb_digibok_2008040104074",title:"Det Nye Testamente",year:1904,publisher:"Det Norske Bibelselskabs Forl.",langs:"nob / grc",dhlabid:"100615340.0"},{urn:"URN:NBN:no-nb_digibok_2017051148061",title:"Bibelens eller Den hellige Skrifts kanoniske Bøger",year:1891,publisher:"Bibelselskabet",langs:"nob",dhlabid:"100634178.0"}];g.map(e=>e.urn);const ye="https://api.nb.no/dhlab",F=ye;async function ve(e,t){const r={urns:t.urns.length?t.urns:null,query:t.query,window:V(t.window,1,25),limit:V(t.limit,1,1e3)},n=await M(e,"/conc",r);return Be(n)}async function Ne(e,t){const r={urn:t.urns.length?t.urns:null,word:t.word,before:Math.max(0,t.before),after:Math.max(0,t.after),samplesize:Math.max(1,t.samplesize)},n=await M(e,"/urncolldist_urn",r);return qe(n).sort((o,l)=>{const s=o.avgDistance??Number.POSITIVE_INFINITY,i=l.avgDistance??Number.POSITIVE_INFINITY;return s-i||l.count-o.count})}async function Se(e,t){const r={urns:t.urns.length?t.urns:null,cutoff:Math.max(0,t.cutoff),words:t.words},n=await M(e,"/frequencies",r);return Array.isArray(n)?n.map(([a,o,l,s])=>({urn:a,word:o,freq:l,urncount:s,relfreq:s?l/s:0})):[]}async function M(e,t,r){const n=`${e.replace(/\/$/,"")}${t}`,a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const l=await a.text();throw new Error(`API-kall feilet (${a.status} ${a.statusText}): ${l}`)}const o=await a.json();return typeof o=="string"?JSON.parse(o):o}function Be(e){return Array.isArray(e)?e:Ee(e)?De(e):[]}function qe(e){if(!Ce(e))return[];const t=new Set;return[e.counts,e.dist,e.bdist].filter(Boolean).forEach(r=>{Object.keys(r).forEach(n=>t.add(n))}),Array.from(t).map(r=>({word:r,count:Number(e.counts?.[r]??0),distance:H(e.dist?.[r]),avgDistance:we(H(e.dist?.[r]),Number(e.counts?.[r]??0))}))}function we(e,t){return e==null||!Number.isFinite(e)||!t?null:e/t}function De(e){const t=new Set;return Object.values(e).forEach(n=>{Array.isArray(n)?n.forEach((a,o)=>t.add(String(o))):n&&typeof n=="object"&&Object.keys(n).forEach(a=>t.add(a))}),Array.from(t).sort((n,a)=>Number(n)-Number(a)).map(n=>{const a={};for(const[o,l]of Object.entries(e))a[o]=_e(l,n);return a})}function _e(e,t){if(Array.isArray(e)){const r=Number(t);return Number.isNaN(r)?null:e[r]}return e&&typeof e=="object"?e[t]:e}function Ee(e){return!!e&&typeof e=="object"}function Ce(e){if(!e||typeof e!="object")return!1;const t=e,r=t.counts!==void 0&&t.counts!==null&&typeof t.counts=="object",n=t.dist!==void 0&&t.dist!==null&&typeof t.dist=="object",a=t.bdist!==void 0&&t.bdist!==null&&typeof t.bdist=="object";return r||n||a}function V(e,t,r){return Math.min(Math.max(e,t),r)}function H(e){const t=Number(e);return Number.isFinite(t)?t:null}const c=document.querySelector("#app");if(!c)throw new Error("Fant ikke rot-elementet med id #app");c.innerHTML=`
  <header class="hero">
    <div class="hero-copy">
      <p class="eyebrow">Bibel-korpus</p>
      <h1>Konkordanser & kollokasjoner</h1>
      <p>
        Velg hvilke utgaver som skal inngå i subkorpuset, og hent konkordanser
        eller kollokasjoner direkte fra NB sitt DH-lab API.
      </p>
    </div>
  </header>

  <main class="workspace">
    <div class="tabs" role="tablist">
      <button class="tab-button" type="button" data-tab-target="corpus">Korpus</button>
      <button class="tab-button" type="button" data-tab-target="concordance">Konkordanser</button>
      <button class="tab-button" type="button" data-tab-target="collocations">Kollokasjoner</button>
      <button class="tab-button" type="button" data-tab-target="frequencies">Opptelling</button>
    </div>

    <section class="panel tab-panel" data-tab="corpus" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Subkorpus</p>
          <h2>Velg bibelutgaver</h2>
        </div>
        <output id="urn-count">0 valgt</output>
      </header>
      <div class="subkorpus-controls">
        <div class="actions">
          <button type="button" data-action="select-all">Velg alle</button>
          <button type="button" data-action="clear-all">Fjern alle</button>
        </div>
        <label class="search-label" for="urn-search">
          <span>Søk etter metadata</span>
          <input id="urn-search" type="search" placeholder="Filtrer på tittel/forfatter/år/målform" />
        </label>
      </div>
      <div id="urn-list" class="urn-list" role="list"></div>
    </section>

    <section class="panel tab-panel" data-tab="concordance" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Konkordanser</p>
          <h2>Søk etter uttrykk</h2>
        </div>
      </header>
      <form id="conc-form" class="stack" autocomplete="off">
        <label>
          <span>Søkestreng (SQLite FTS5)</span>
          <input name="query" type="text" placeholder="" required />
        </label>
        <div class="form-grid">
          <label>
            <span>Vindusstørrelse</span>
            <input name="window" type="number" min="1" max="25" value="25" />
          </label>
          <label>
            <span>Maks linjer per dokument</span>
            <input name="limit" type="number" min="1" max="1000" value="100" />
          </label>
        </div>
        <button type="submit">Hent konkordanser</button>
      </form>
      <div class="result-actions">
        <button type="button" id="download-conc" disabled>Last ned CSV</button>
      </div>
      <div id="conc-results" class="results tall"></div>
    </section>

    <section class="panel tab-panel" data-tab="collocations" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Kollokasjoner</p>
          <h2>Finn medkontekst</h2>
        </div>
      </header>
      <form id="coll-form" class="stack" autocomplete="off">
        <label>
          <span>Basiskord</span>
          <input name="word" type="text" value="arbeid" required />
        </label>
        <div class="form-grid">
          <label>
            <span>Ord før</span>
            <input name="before" type="number" min="0" max="25" value="5" />
          </label>
          <label>
            <span>Ord etter</span>
            <input name="after" type="number" min="0" max="25" value="5" />
          </label>
          <label>
            <span>Utvalg (samplesize)</span>
            <input name="samplesize" type="number" min="1" value="200000" />
          </label>
        </div>
        <button type="submit">Hent kollokasjoner</button>
      </form>
      <div class="result-actions">
        <button type="button" id="download-coll" disabled>Last ned CSV</button>
      </div>
      <div id="coll-results" class="results"></div>
    </section>
    <section class="panel tab-panel" data-tab="frequencies" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Opptelling</p>
          <h2>Tell ord i utvalgte bibler</h2>
        </div>
      </header>
      <form id="freq-form" class="stack" autocomplete="off">
        <label>
          <span>Ord/uttrykk (kommaseparert)</span>
          <textarea name="words" rows="3" placeholder="helvete, evighet, etterliv" required></textarea>
        </label>
        <div class="form-grid">
          <label>
            <span>Cutoff (minimum antall)</span>
            <input name="cutoff" type="number" min="0" value="0" />
          </label>
        </div>
        <div class="mode-switch">
          <label>
            <input type="radio" name="freq-mode" value="freq" checked />
            Absolutt
          </label>
          <label>
            <input type="radio" name="freq-mode" value="relfreq" />
            Relativ
          </label>
        </div>
        <button type="submit">Tell ord</button>
      </form>
      <div class="result-actions">
        <button type="button" id="download-freq" disabled>Last ned CSV</button>
  </div>
      <div id="freq-results" class="results tall"></div>
    </section>

  </main>
`;const G=c.querySelector("#urn-list"),K=c.querySelector("#urn-count"),J=c.querySelector("#urn-search"),W=c.querySelector("#conc-results"),Q=c.querySelector("#coll-results"),Y=c.querySelector("#freq-results"),X=c.querySelector("#conc-form"),Z=c.querySelector("#coll-form"),ee=c.querySelector("#freq-form"),te=c.querySelector("#download-conc"),ne=c.querySelector("#download-coll"),re=c.querySelector("#download-freq"),oe=Array.from(c.querySelectorAll("[data-tab-target]")),ae=Array.from(c.querySelectorAll("[data-tab]"));if(!G||!K||!W||!Q||!Y||!X||!Z||!ee||!J||!te||!ne||!re||oe.length===0||ae.length===0)throw new Error("UI-elementer mangler i DOM-en");const Re=K,k=W,y=Q,f=Y,q=X,v=Z,_=ee,C=J,le=te,se=ne,ie=re,U=G,m=new Set(g.map(e=>e.urn)),ce=oe,Ae=ae,de=new Map;function ue(e){return e==null?"":String(e).trim().replace(/\.0+$/,"")}function $(e,t=!0,r){if(e==null)return;const n=t?ue(e):String(e).trim();n&&de.set(n,r)}g.forEach(e=>{$(e.urn,!1,e),$(e.dhlabid,!0,e)});A();L();ke("concordance");let be=[],fe=[],me=[],pe=[],ge=[],he=[],I=[],R=[],E="freq",B=null,N="asc";const T=Array.from(_.querySelectorAll('input[name="freq-mode"]'));T.length&&(E=T.find(e=>e.checked)?.value==="relfreq"?"relfreq":"freq",T.forEach(e=>{e.addEventListener("change",()=>{const t=e.value==="relfreq"?"relfreq":"freq";t!==E&&(E=t,j())})}));c.querySelector('[data-action="select-all"]')?.addEventListener("click",()=>{Le()});c.querySelector('[data-action="clear-all"]')?.addEventListener("click",()=>{Ue()});C.addEventListener("input",()=>{A(C.value)});ce.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tabTarget;t&&ke(t)})});q.addEventListener("submit",async e=>{e.preventDefault();const t=q.querySelector('input[name="query"]'),r=q.querySelector('input[name="window"]'),n=q.querySelector('input[name="limit"]');if(!t||!r||!n)return;const a=t.value.trim();if(!a){d(k,"Du må skrive inn en søkestreng.","error");return}d(k,"Henter konkordanser …","info"),w([],[]);try{const o=await ve(F,{urns:x(),query:a,window:parseInt(r.value,10)||25,limit:parseInt(n.value,10)||100});if(!o.length){d(k,"Ingen treff for søket.","info"),w([],[]);return}const l=o.map(i=>({...i,kilde:i.urn?`<a href="https://www.nb.no/items/${encodeURIComponent(String(i.urn))}" target="_blank" rel="noopener noreferrer">Til NB</a>`:""})),s=O(k,l,["docid","kilde","conc"],new Set(["kilde","conc"]));w(l,s)}catch(o){d(k,o.message,"error"),w([],[])}});v.addEventListener("submit",async e=>{e.preventDefault();const t=v.querySelector('input[name="word"]'),r=v.querySelector('input[name="before"]'),n=v.querySelector('input[name="after"]'),a=v.querySelector('input[name="samplesize"]');if(!t||!r||!n||!a)return;const o=t.value.trim();if(!o){d(y,"Skriv inn et basiskord.","error");return}d(y,"Henter kollokasjoner …","info"),D([],[]);try{const l=await Ne(F,{urns:x(),word:o,before:parseInt(r.value,10)||5,after:parseInt(n.value,10)||5,samplesize:parseInt(a.value,10)||2e5});if(!l.length){d(y,"Ingen kollokasjoner returnert.","info"),D([],[]);return}const s=O(y,l,["word","count","avgDistance"]);D(l,s)}catch(l){d(y,l.message,"error"),D([],[])}});le.addEventListener("click",()=>{P(fe,be,"konkordanser.csv")});se.addEventListener("click",()=>{P(pe,me,"kollokasjoner.csv")});_.addEventListener("submit",async e=>{e.preventDefault();const t=_.querySelector('textarea[name="words"]'),r=_.querySelector('input[name="cutoff"]');if(!t||!r)return;const n=t.value.split(/[,\n]/).map(o=>o.trim()).filter(Boolean);if(!n.length){d(f,"Skriv inn minst ett ord eller uttrykk.","error");return}const a=x();if(!a.length){d(f,"Velg minst én bibel i korpus-fanen.","error");return}d(f,"Henter opptelling …","info"),S([],[]);try{const o=await Se(F,{urns:a,words:n,cutoff:parseInt(r.value,10)||0});if(!o.length){d(f,"Ingen treff for disse ordene.","info"),S([],[]);return}Te(o),j()}catch(o){d(f,o.message,"error"),S([],[])}});ie.addEventListener("click",()=>{P(he,ge,"opptelling.csv")});function A(e=""){if(!U)return;const t=e.toLowerCase().trim(),r=document.createDocumentFragment();if(g.forEach(n=>{const a=[n.title,n.authors,n.publisher,n.langs,n.year?String(n.year):""].filter(Boolean).join(" ").toLowerCase();if(t&&!a.includes(t))return;const o=document.createElement("label");o.className="urn-card",o.setAttribute("role","listitem");const l=document.createElement("input");l.type="checkbox",l.value=n.urn,l.checked=m.has(n.urn),l.addEventListener("change",()=>{l.checked?m.add(n.urn):m.delete(n.urn),L()});const s=document.createElement("div");s.className="urn-info";const i=document.createElement("p");i.className="urn-title",i.textContent=n.year?`${n.title} (${n.year})`:n.title;const b=[n.authors,n.publisher,n.langs?`Målform: ${n.langs}`:void 0].filter(Boolean),u=document.createElement("p");u.className="urn-meta",u.textContent=b.join(" • "),s.append(i),b.length&&s.append(u),o.append(l,s),r.append(o)}),r.hasChildNodes())U.replaceChildren(r);else{const n=document.createElement("p");n.className="message info",n.textContent=t?`Ingen treff for «${e.trim()}».`:"Ingen elementer i korpuset.",U.replaceChildren(n)}}function Le(){m.clear(),g.forEach(e=>m.add(e.urn)),A(C.value),L()}function Ue(){m.clear(),A(C.value),L()}function L(){const e=m.size,t=g.length;Re.value=e===0?"0 valgt":e===t?`Alle (${t})`:`${e} valgt`}function x(){return Array.from(m)}function d(e,t,r){e.innerHTML=`<p class="message ${r}">${t}</p>`}function O(e,t,r,n=new Set){const a=r?.length&&r?.some(b=>b in t[0])?r:Object.keys(t[0]),o=document.createElement("table"),l=document.createElement("thead"),s=document.createElement("tr");a.forEach(b=>{const u=document.createElement("th");u.textContent=b,u.dataset.column=b,s.appendChild(u)}),l.appendChild(s),o.appendChild(l);const i=document.createElement("tbody");return t.forEach(b=>{const u=document.createElement("tr");a.forEach(z=>{const h=document.createElement("td"),p=b[z];p==null?h.textContent="":n.has(z)&&typeof p=="string"?h.innerHTML=p:typeof p=="number"?h.textContent=Number.isFinite(p)?p.toLocaleString("nb-NO",{maximumFractionDigits:3}):"":h.textContent=String(p),u.appendChild(h)}),i.appendChild(u)}),o.appendChild(i),e.innerHTML="",e.appendChild(o),a}function w(e,t){fe=e,be=t,le.disabled=e.length===0}function D(e,t){pe=e,me=t,se.disabled=e.length===0}function S(e,t){he=e,ge=t,ie.disabled=e.length===0}function Te(e){const t=new Set,r=new Map;e.forEach(n=>{t.add(n.word);const a=ue(n.urn),o=de.get(a),l=o?.urn??a;let s=r.get(l);s||(s={urn:l,tittel:o?.title??l,år:o?.year??"",målform:o?.langs??"",values:{}},r.set(l,s)),s.values[n.word]={freq:n.freq,relfreq:n.relfreq}}),R=Array.from(t).sort((n,a)=>n.localeCompare(a,"nb")),I=Array.from(r.values()).sort((n,a)=>String(n.tittel).localeCompare(String(a.tittel),"nb"))}function j(){if(!I.length){d(f,"Ingen data å vise.","info"),S([],[]);return}const e=["år","målform","tittel","nb"],t=R.concat(e),r=I.map(o=>{const l={};return R.forEach(s=>{const i=o.values[s];if(!i){l[s]=0;return}l[s]=E==="relfreq"?i.relfreq*100:i.freq}),l.år=o.år??"",l.målform=o.målform??"",l.tittel=o.tittel??"",l.nb=o.urn?`<a href="https://www.nb.no/items/${encodeURIComponent(o.urn)}" target="_blank" rel="noopener noreferrer">NB</a>`:"",l}),n=Ie(r),a=O(f,n,t,new Set(["nb"]));S(n,a),Fe()}function Ie(e){if(!B)return e;const t=B,r=N==="asc"?1:-1,n=R.includes(t);return[...e].sort((a,o)=>{const l=a[t],s=o[t];let i;return n?i=(Number(l)||0)-(Number(s)||0):i=String(l??"").localeCompare(String(s??""),"nb",{numeric:!0}),i*r})}function Fe(){const e=f.querySelector("table");if(!e)return;e.querySelectorAll("th").forEach(r=>{const n=r.dataset.column;r.classList.remove("sortable"),r.removeAttribute("aria-sort"),r.onclick=null,!(!n||n==="nb")&&(r.classList.add("sortable"),n===B&&r.setAttribute("aria-sort",N==="asc"?"ascending":"descending"),r.onclick=()=>Me(n))})}function Me(e){e!=="nb"&&(B===e?N=N==="asc"?"desc":"asc":(B=e,N="asc"),j())}function P(e,t,r){if(!e.length)return;const n=t.length?t:Object.keys(e[0]),a=[n.join(",")];e.forEach(i=>{const b=n.map(u=>xe(i[u])).join(",");a.push(b)});const o=new Blob([a.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(o),s=document.createElement("a");s.href=l,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function xe(e){const t=typeof e=="string"?e.replace(/<[^>]*>/g,""):e==null?"":String(e),r=/[",\n]/.test(t),n=t.replace(/"/g,'""');return r?`"${n}"`:n}function ke(e){ce.forEach(t=>{t.classList.toggle("is-active",t.dataset.tabTarget===e)}),Ae.forEach(t=>{t.classList.toggle("is-active",t.dataset.tab===e)})}
