(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();const y=[{urn:"URN:NBN:no-nb_digibok_2009021704085",title:"NTR - Det nye testamente revidert . [ 1 ] : Lukasevangeliet , Første tessalonikerbrev , Andre tessalonikerbrev , Galaterbrevet , Filipperbrevet",year:2003,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2008052304066",title:"Det Nye testamente : oversatt for ungdom",year:1959,authors:"Osnes , Torbjørn",publisher:"Det Norske bibelselskaps forl.",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2011060308011",title:"Det nye testamentet",year:2005,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2012033008102",title:"Evangeliet etter Lukas",year:1973,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2012081508153",title:"Vær ikke redde : evangeliet etter Markus",year:1951,authors:"Skard , Vemund / Osnes , Torbjørn",publisher:"Det norske bibelselskaps forlag",langs:"nob / grc"},{urn:"URN:NBN:no-nb_digibok_2013030506026",title:"Bibelen : det Gamle og det Nye testamente : [ bokmål ]",year:1978,publisher:"Det Norske bibelselskaps forlag",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2013020808015",title:"NTR - Det nye testamente revidert . [ 2 ] : Markusevangeliet , Romerbrevet , Første korinterbrev , Andre korinterbrev",year:2003,publisher:"Det norske bibelselskap",langs:"mul / nob / nno"},{urn:"URN:NBN:no-nb_digibok_2013061206082",title:"NTR - Det nye testamente revidert . [ 3 ] : Matteusevangeliet , Efeserbrevet , Kolosserbrevet",year:2004,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2015110407068",title:"Godt nytt : Det nye testamentet for menneske i dag ; illustrert av Annie Vallotton",year:1976,authors:"Vallotton , Annie",publisher:"Bibelselskapet",langs:"nno"},{urn:"URN:NBN:no-nb_digibok_2016061748023",title:"Godt nytt : Det nye testamente for mennesker i dag : ny oversettelse av 1975",year:1975,authors:"Vallotton , Annie",publisher:"Det norske bibelselskaps forl.",langs:"nob / gre"},{urn:"URN:NBN:no-nb_digibok_2018020748002",title:"Når Ordet blir norsk : norske bibeloversettelser 1945-2011",year:2011,authors:"Bøe , Sverre / Holmås , Geir Otto",publisher:"Tapir akademisk forl.",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2018030805008",title:"Utvalg av det Gamle testamente : oversettelse av 1966",year:1966,publisher:"Det Norske bibelselskaps forl.",langs:"nob / heb"},{urn:"URN:NBN:no-nb_digibok_2017091807031",title:"Bibelen , eller Den Hellige skrift : det gamle og det Nye testamentes kanoniske bøker",year:1930,publisher:"Det Norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2019061928001",title:"Biblia : Det er den gantske Hellige Scrifft , vdsæt paa Danske",year:1550,publisher:"aff Ludowich Dietz",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2021012648506",title:"Bibelen , eller Den hellige Skrift indeholdende det Gamle og Nye Testamentes kanoniske Bøger",year:1905,publisher:"Det norske Bibelselskabs Forl.",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2016031029001",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 3 : Den Tredie Part Af det Gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2016040729001",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 1 : Den første Part Af det Gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2016040729002",title:"Biblia , Paa Danske : Det er , Den gandske hellige Skriftis Bøgger , Paa ny igiennemseete , med flid , efter den Ebræiske oc Grækiske Text , det næste mueligt var , Oc forbedrede med ny Summarier , fuldkommeligere Concordantzer , oc korte antegnelser udi Bredden , anlangendis de mørcke Ord oc maader ad tale med. 2 : Den Anden Part Af det gamle Testamentis Bøgger",year:1647,publisher:"[ved Melchior Martzan oc Melchior Winckler]",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2010110206027",title:"Evangilja : eller Fagnad-bodi etter Mattæus",year:1915,authors:"Seippel , Alexander",publisher:"Det norske bibel-sellskape",langs:"nno / grc"},{urn:"URN:NBN:no-nb_digibok_2011052608017",title:"Det nye testamentet",year:2005,publisher:"Det norske bibelselskap",langs:"nno"},{urn:"URN:NBN:no-nb_digibok_2011053008068",title:"NTR - Det nye testamente revidert . [ 5 ] : Apostlenes gjerninger , Første timoteusbrev , Andre timoteusbrev , Brevet til Titus , Brevet til Filemon , Hebreerbrevet , Jakobs brev , Første petersbrev , Andre petersbrev , Judas ' brev",year:2005,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2022030107531",title:"Bibelen : Den hellige skrift : Det gamle og Det nye testamente",year:1985,publisher:"Det norske bibelselskap",langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2021041548624",title:"Bibelen , eller den Hellige Skrift : indeholdende Det gamle og nye Testaments kanoniske Bøger , tilligemed Det gamle Testamentes apokryfiske Bøger",year:1908,langs:"nob"},{urn:"URN:NBN:no-nb_digibok_2022011028001",title:"Biblia : Det er , Den gantske Hellige Scrifft , paa Danske",year:1589,authors:"Dietrich , Veit / Luther , Martin",publisher:"Aff Matz Vingaardt",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2022011928001",title:"Biblia : Det er Den gantske Hellige Scrifft paa Danske",year:1633,authors:"Luther , Martin / Dietrich , Veit / Martzan , Melchior / Sartor , Salomon",publisher:"Prentet ved Melchior Martzan",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2022030107535",title:"Bibelen : det Gamle og det Nye testamentet : [ nynorsk ]",year:1978,publisher:"Det Norske bibelselskap",langs:"nno"},{urn:"URN:NBN:no-nb_digibok_2022012528002",title:"Biblia , Paa Danske : Det er Den gantske hellige scriftis Bøgger igen [ n ] em seete med flijd effter den Ebræiske oc Grækeske Text etc. det negste mueligt vaar Oc effter som de paa andre atskillige Tungemaal vaare best vdsatte",year:1607,authors:"Resen , Hans Poulsen",publisher:"[utgiver ikke identifisert]",langs:"dan"},{urn:"URN:NBN:no-nb_digibok_2008040104074",title:"Det Nye Testamente",year:1904,publisher:"Det Norske Bibelselskabs Forl.",langs:"nob / grc"},{urn:"URN:NBN:no-nb_digibok_2017051148061",title:"Bibelens eller Den hellige Skrifts kanoniske Bøger",year:1891,publisher:"Bibelselskabet",langs:"nob"}];y.map(e=>e.urn);const ee="https://api.nb.no/dhlab",U=ee;async function te(e,t){const o={urns:t.urns.length?t.urns:null,query:t.query,window:R(t.window,1,25),limit:R(t.limit,1,1e3)},n=await T(e,"/conc",o);return re(n)}async function ne(e,t){const o={urn:t.urns.length?t.urns:null,word:t.word,before:Math.max(0,t.before),after:Math.max(0,t.after),samplesize:Math.max(1,t.samplesize)},n=await T(e,"/urncolldist_urn",o);return oe(n).sort((a,s)=>{const l=a.avgDistance??Number.POSITIVE_INFINITY,c=s.avgDistance??Number.POSITIVE_INFINITY;return l-c||s.count-a.count})}async function T(e,t,o){const n=`${e.replace(/\/$/,"")}${t}`,r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const s=await r.text();throw new Error(`API-kall feilet (${r.status} ${r.statusText}): ${s}`)}const a=await r.json();return typeof a=="string"?JSON.parse(a):a}function re(e){return Array.isArray(e)?e:ie(e)?se(e):[]}function oe(e){if(!ce(e))return[];const t=new Set;return[e.counts,e.dist,e.bdist].filter(Boolean).forEach(o=>{Object.keys(o).forEach(n=>t.add(n))}),Array.from(t).map(o=>({word:o,count:Number(e.counts?.[o]??0),distance:C(e.dist?.[o]),avgDistance:ae(C(e.dist?.[o]),Number(e.counts?.[o]??0))}))}function ae(e,t){return e==null||!Number.isFinite(e)||!t?null:e/t}function se(e){const t=new Set;return Object.values(e).forEach(n=>{Array.isArray(n)?n.forEach((r,a)=>t.add(String(a))):n&&typeof n=="object"&&Object.keys(n).forEach(r=>t.add(r))}),Array.from(t).sort((n,r)=>Number(n)-Number(r)).map(n=>{const r={};for(const[a,s]of Object.entries(e))r[a]=le(s,n);return r})}function le(e,t){if(Array.isArray(e)){const o=Number(t);return Number.isNaN(o)?null:e[o]}return e&&typeof e=="object"?e[t]:e}function ie(e){return!!e&&typeof e=="object"}function ce(e){if(!e||typeof e!="object")return!1;const t=e,o=t.counts!==void 0&&t.counts!==null&&typeof t.counts=="object",n=t.dist!==void 0&&t.dist!==null&&typeof t.dist=="object",r=t.bdist!==void 0&&t.bdist!==null&&typeof t.bdist=="object";return o||n||r}function R(e,t,o){return Math.min(Math.max(e,t),o)}function C(e){const t=Number(e);return Number.isFinite(t)?t:null}const i=document.querySelector("#app");if(!i)throw new Error("Fant ikke rot-elementet med id #app");i.innerHTML=`
  <header class="hero">
    <div class="hero-copy">
      <p class="eyebrow">Bibel-korpus</p>
      <h1>Konkordanser & kollokasjoner</h1>
      <p>
        Velg hvilke utgaver som skal inngå i subkorpuset, og hent konkordanser
        eller kollokasjoner direkte fra NB sitt DH-lab API.
      </p>
    </div>
  </header>

  <main class="workspace">
    <div class="tabs" role="tablist">
      <button class="tab-button" type="button" data-tab-target="corpus">Korpus</button>
      <button class="tab-button" type="button" data-tab-target="concordance">Konkordanser</button>
      <button class="tab-button" type="button" data-tab-target="collocations">Kollokasjoner</button>
    </div>

    <section class="panel tab-panel" data-tab="corpus" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Subkorpus</p>
          <h2>Velg bibelutgaver</h2>
        </div>
        <output id="urn-count">0 valgt</output>
      </header>
      <div class="subkorpus-controls">
        <div class="actions">
          <button type="button" data-action="select-all">Velg alle</button>
          <button type="button" data-action="clear-all">Fjern alle</button>
        </div>
        <label class="search-label" for="urn-search">
          <span>Søk etter metadata</span>
          <input id="urn-search" type="search" placeholder="Filtrer på tittel/forfatter/år/målform" />
        </label>
      </div>
      <div id="urn-list" class="urn-list" role="list"></div>
    </section>

    <section class="panel tab-panel" data-tab="concordance" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Konkordanser</p>
          <h2>Søk etter uttrykk</h2>
        </div>
      </header>
      <form id="conc-form" class="stack" autocomplete="off">
        <label>
          <span>Søkestreng (SQLite FTS5)</span>
          <input name="query" type="text" placeholder="f.eks. «Gud NEAR/5 kjærlighet»" required />
        </label>
        <div class="form-grid">
          <label>
            <span>Vindusstørrelse</span>
            <input name="window" type="number" min="1" max="25" value="10" />
          </label>
          <label>
            <span>Maks linjer per dokument</span>
            <input name="limit" type="number" min="1" max="1000" value="100" />
          </label>
        </div>
        <button type="submit">Hent konkordanser</button>
      </form>
      <div class="result-actions">
        <button type="button" id="download-conc" disabled>Last ned CSV</button>
      </div>
      <div id="conc-results" class="results tall"></div>
    </section>

    <section class="panel tab-panel" data-tab="collocations" role="tabpanel">
      <header>
        <div>
          <p class="eyebrow">Kollokasjoner</p>
          <h2>Finn medkontekst</h2>
        </div>
      </header>
      <form id="coll-form" class="stack" autocomplete="off">
        <label>
          <span>Basiskord</span>
          <input name="word" type="text" value="arbeid" required />
        </label>
        <div class="form-grid">
          <label>
            <span>Ord før</span>
            <input name="before" type="number" min="0" max="25" value="5" />
          </label>
          <label>
            <span>Ord etter</span>
            <input name="after" type="number" min="0" max="25" value="5" />
          </label>
          <label>
            <span>Utvalg (samplesize)</span>
            <input name="samplesize" type="number" min="1" value="200000" />
          </label>
        </div>
        <button type="submit">Hent kollokasjoner</button>
      </form>
      <div class="result-actions">
        <button type="button" id="download-coll" disabled>Last ned CSV</button>
      </div>
      <div id="coll-results" class="results"></div>
    </section>
  </main>
`;const L=i.querySelector("#urn-list"),A=i.querySelector("#urn-count"),j=i.querySelector("#urn-search"),O=i.querySelector("#conc-results"),I=i.querySelector("#coll-results"),M=i.querySelector("#conc-form"),x=i.querySelector("#coll-form"),q=i.querySelector("#download-conc"),F=i.querySelector("#download-coll"),P=Array.from(i.querySelectorAll("[data-tab-target]")),z=Array.from(i.querySelectorAll("[data-tab]"));if(!L||!A||!O||!I||!M||!x||!j||!q||!F||P.length===0||z.length===0)throw new Error("UI-elementer mangler i DOM-en");const ue=A,f=O,k=I,N=M,h=x,D=j,H=q,V=F,w=L,m=new Set(y.map(e=>e.urn)),$=P,de=z;S();_();Z("concordance");let G=[],K=[],J=[],W=[];i.querySelector('[data-action="select-all"]')?.addEventListener("click",()=>{be()});i.querySelector('[data-action="clear-all"]')?.addEventListener("click",()=>{me()});D.addEventListener("input",()=>{S(D.value)});$.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tabTarget;t&&Z(t)})});N.addEventListener("submit",async e=>{e.preventDefault();const t=N.querySelector('input[name="query"]'),o=N.querySelector('input[name="window"]'),n=N.querySelector('input[name="limit"]');if(!t||!o||!n)return;const r=t.value.trim();if(!r){b(f,"Du må skrive inn en søkestreng.","error");return}b(f,"Henter konkordanser …","info"),v([],[]);try{const a=await te(U,{urns:Q(),query:r,window:parseInt(o.value,10)||10,limit:parseInt(n.value,10)||100});if(!a.length){b(f,"Ingen treff for søket.","info"),v([],[]);return}const s=a.map(c=>({...c,kilde:c.urn?`<a href="https://www.nb.no/items/${encodeURIComponent(String(c.urn))}" target="_blank" rel="noopener noreferrer">Til NB</a>`:""})),l=Y(f,s,["docid","kilde","conc"],new Set(["kilde","conc"]));v(s,l)}catch(a){b(f,a.message,"error"),v([],[])}});h.addEventListener("submit",async e=>{e.preventDefault();const t=h.querySelector('input[name="word"]'),o=h.querySelector('input[name="before"]'),n=h.querySelector('input[name="after"]'),r=h.querySelector('input[name="samplesize"]');if(!t||!o||!n||!r)return;const a=t.value.trim();if(!a){b(k,"Skriv inn et basiskord.","error");return}b(k,"Henter kollokasjoner …","info"),B([],[]);try{const s=await ne(U,{urns:Q(),word:a,before:parseInt(o.value,10)||5,after:parseInt(n.value,10)||5,samplesize:parseInt(r.value,10)||2e5});if(!s.length){b(k,"Ingen kollokasjoner returnert.","info"),B([],[]);return}const l=Y(k,s,["word","count","avgDistance"]);B(s,l)}catch(s){b(k,s.message,"error"),B([],[])}});H.addEventListener("click",()=>{X(K,G,"konkordanser.csv")});V.addEventListener("click",()=>{X(W,J,"kollokasjoner.csv")});function S(e=""){if(!w)return;const t=e.toLowerCase().trim(),o=document.createDocumentFragment();if(y.forEach(n=>{const r=[n.title,n.authors,n.publisher,n.langs,n.year?String(n.year):""].filter(Boolean).join(" ").toLowerCase();if(t&&!r.includes(t))return;const a=document.createElement("label");a.className="urn-card",a.setAttribute("role","listitem");const s=document.createElement("input");s.type="checkbox",s.value=n.urn,s.checked=m.has(n.urn),s.addEventListener("change",()=>{s.checked?m.add(n.urn):m.delete(n.urn),_()});const l=document.createElement("div");l.className="urn-info";const c=document.createElement("p");c.className="urn-title",c.textContent=n.year?`${n.title} (${n.year})`:n.title;const d=[n.authors,n.publisher,n.langs?`Målform: ${n.langs}`:void 0].filter(Boolean),u=document.createElement("p");u.className="urn-meta",u.textContent=d.join(" • "),l.append(c),d.length&&l.append(u),a.append(s,l),o.append(a)}),o.hasChildNodes())w.replaceChildren(o);else{const n=document.createElement("p");n.className="message info",n.textContent=t?`Ingen treff for «${e.trim()}».`:"Ingen elementer i korpuset.",w.replaceChildren(n)}}function be(){m.clear(),y.forEach(e=>m.add(e.urn)),S(D.value),_()}function me(){m.clear(),S(D.value),_()}function _(){const e=m.size,t=y.length;ue.value=e===0?"0 valgt":e===t?`Alle (${t})`:`${e} valgt`}function Q(){return Array.from(m)}function b(e,t,o){e.innerHTML=`<p class="message ${o}">${t}</p>`}function Y(e,t,o,n=new Set){const r=o?.length&&o?.some(d=>d in t[0])?o:Object.keys(t[0]),a=document.createElement("table"),s=document.createElement("thead"),l=document.createElement("tr");r.forEach(d=>{const u=document.createElement("th");u.textContent=d,l.appendChild(u)}),s.appendChild(l),a.appendChild(s);const c=document.createElement("tbody");return t.forEach(d=>{const u=document.createElement("tr");r.forEach(E=>{const g=document.createElement("td"),p=d[E];p==null?g.textContent="":n.has(E)&&typeof p=="string"?g.innerHTML=p:typeof p=="number"?g.textContent=Number.isFinite(p)?p.toLocaleString("nb-NO",{maximumFractionDigits:3}):"":g.textContent=String(p),u.appendChild(g)}),c.appendChild(u)}),a.appendChild(c),e.innerHTML="",e.appendChild(a),r}function v(e,t){K=e,G=t,H.disabled=e.length===0}function B(e,t){W=e,J=t,V.disabled=e.length===0}function X(e,t,o){if(!e.length)return;const n=t.length?t:Object.keys(e[0]),r=[n.join(",")];e.forEach(c=>{const d=n.map(u=>pe(c[u])).join(",");r.push(d)});const a=new Blob([r.join(`
`)],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}function pe(e){const t=typeof e=="string"?e.replace(/<[^>]*>/g,""):e==null?"":String(e),o=/[",\n]/.test(t),n=t.replace(/"/g,'""');return o?`"${n}"`:n}function Z(e){$.forEach(t=>{t.classList.toggle("is-active",t.dataset.tabTarget===e)}),de.forEach(t=>{t.classList.toggle("is-active",t.dataset.tab===e)})}
